# 全景拥抱小程序（一）
　　小程序有多火，想必不用多说大家都知道，从最初的“鸡肋”到现在的逐渐趋于成熟，目前多数传统互联网公司都想在小程序中再分一杯羹了。而从事全景工作的公司，目前涉足小程序的少之又少，主要是因为全景是展现在网页中，而小程序起初是不支持嵌入网页的，这让好多有想法的青年望而却步。但是，自从小程序开放了web-view，一切就不一样了，小程序可以真正嵌入页面，对于一些想要迁移小程序的项目来说，无不是一件好事。
　　但是，事情往往不会这么简单，小程序的坑，还是要踩的。
　　下面就由我的实际项目经验来说说（搜索小程序：灵墨视界趣改改车），如何使用web-view在小程序中嵌入全景。（这么就没有发帖，就是因为搞小程序去了，这也算是出关吧）。
> web-view 组件是一个可以用来承载网页的容器，会自动铺满整个小程序页面。个人类型与海外类型的小程序暂不支持使用。

小程序官网是这样说的，首先，web-view是小程序的一个组件，和其他view、image一样。使用起来也是非常简单，web-view有一个属性：src，填写页面的地址：

````
<!-- 指向微信公众平台首页的web-view -->
<web-view src="https://mp.weixin.qq.com/"></web-view>
```
这里需要注意的是，① web-view会铺满整个小程序，也就是说，web-view页面的小程序只能有且只有一个web-view,如果有其他组件，也不会显示。② 链接的域名必须在小程序后台配置。详见[小程序后台管理](https://mp.weixin.qq.com/)。
但是往往我们要的不只是简单的在小程序中展示页面，需要的是页面能和小程序有交互，如我的项目需求是：web-view展示的是汽车脚垫的定制，在汽车内饰的全景页中可以360°体验定制汽车脚垫，选择好脚垫款式后点击购物车进入订单页

　　这就涉及到外部页面如何和小程序交互了。也就是说，在全景中将定制的结果传递给小程序，小程序拿到了参数，才能做下一步的创建订单的工作，那么，外部页面如何像小程序传递信息呢？这部分的工作要在页面中着手；
首先，在页面的html中引入微信的JDK：

```
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
```
　　这样就可以使用web-view的接口了。那么，该怎样传递参数？传递什么参数？小程序如何拿到参数，拿到参数又怎么办呢？问题我们一步步解决。
本质上，我们要传递的是定制的结果，它可能是一个字符串，一个id，数字或是其他。我的项目中相对简单，只需要传递结果的中文字符串，当小程序拿到这个字符串作为订单的一项展示。     
　　上边说过，在全景页中选好款式，点击下单，就会进入小程序的订单页面，这时就需要把参数带上。进入小程序的订单页（这个当然是自己预先写好的小程序页面。我传入的参数实际上是各个scene的title，因为每定制一次脚垫的样式，就会更换一张图，这样我就可以把各个scene的title作为样式参数了。
下单的函数，我写在krpano的action中：

```
<!--小程序订单函数-->
	<action name="mnapp_orderform" type="javascript" ><![CDATA[
		var colors=krpano.get("scene[get(xml.scene)].title");
        colors = "包围脚垫 " + colors;
		var url="/pages/createorder/index?data=" + colors;
	 	wx.miniProgram.navigateTo({url: url});
	]]>

	</action>
```

　　首先获取当前场景的title，然后根据需求处理一下，变量url是小程序的订单页面的路径，并在路径后添加参数，这个参数就是上边的title了，然后进入小程序订单页，这里用到了小程序导航接口<span class="singlecode">wx.miniProgram.navigateTo</span>进入另一个页面。根据小程序的文档，小程序的路由是可以接参数的，而参数的获取可以在onload中获取。

```
onLoad:function(options){
	this.setData({matStyle:options.data});
}
```
　　在小程序的生命周期函数onLoad中获取参数(data)，并把它存储起来。
这样就实现了外部页面向小程序传递数据了。整个流程也是非常简单。

　　1.引入JDK ==> 2. 获取全景中的参数，使用小程序导航接口拼接路径来传递参数 ==> 3.onLoad中获取参数。

　　下一节将会说说全景在小程序的定制结果分享的实现。敬请关注！！

